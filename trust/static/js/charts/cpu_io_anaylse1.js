$(document).ready(function() {
  $.get("static/json/data.json",function(data){
    var iodata = data.dataList[0];
    $("input[name='errname']").val(iodata.errname);
    $("input[name='starttime']").val(iodata.starttime);
    $("input[name='endtime']").val(iodata.endtime);
    $("textarea[name='errdesc']").val(iodata.errdesc);
  });


    $("#btn-markmax,#btn-markmin").click(function(){
        $(this).toggleClass("btn-tool-active");
    });

require.config({
    paths: {
        echarts: '/static/js'
    }
});

require(
    [
        'echarts',
        'echarts/chart/bar',
        'echarts/chart/line',
        'echarts/chart/map',
        'echarts/chart/radar'
    ],
    function (ec) {
        //--- 折柱 ---
        var option =[];
        option[0] = {

            tooltip:{
                trigger:'axis',
               /* formatter:function(params,ticket,callback) {
                    if(params.name=='1')
                        return 'cpu下降，io上升，<br/>xxxxxxxxxx<br/>xxxxxxsdfsad<br/>adfavfdcxv';

                    else if(params.name=='2')
                        return '';
                    else return params.name+'<br/>'+params.seriesName+'<br/>'+params.value;
                }*/
            },
            legend: {
                data:['IO','CPU%','aaa'],
                x: 'left',
                y:'50',
                orient: 'vertical',
                selected: {
               'CPU%' : true
                }
            },
            dataZoom : {
                show : true,
                realtime : true,
                start : 0,
                end : 100
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    axisLine: {onZero: false},
                    data : ['14:46:01', '14:46:31', '14:47:01', '14:47:31', '14:48:01', '14:48:31', '14:49:01', '14:49:31', '14:50:01', '14:50:31', '14:51:01', '14:51:31', '14:52:01', '14:52:31', '14:53:01', '14:53:31', '14:54:01', '14:54:31', '14:55:01', '14:55:31', '14:56:01', '14:56:31', '14:57:01', '14:57:31', '14:58:01', '14:58:31', '14:59:01', '14:59:31', '15:00:01', '15:00:31', '15:01:01', '15:01:31', '15:02:01', '15:02:31', '15:03:01', '15:03:31', '15:04:01', '15:04:31', '15:05:01', '15:05:31', '15:06:01', '15:06:31', '15:07:01', '15:07:31', '15:08:01', '15:08:31', '15:09:01', '15:09:31', '15:10:01', '15:10:31', '15:11:01', '15:11:31', '15:12:01', '15:12:31', '15:13:01', '15:13:31', '15:14:01', '15:14:31', '15:15:01', '15:15:31', '15:16:01', '15:16:31', '15:17:01', '15:17:31', '15:18:02', '15:18:32', '15:19:02', '15:19:32', '15:20:02', '15:20:32', '15:21:02', '15:21:32', '15:22:02', '15:22:32', '15:23:02', '15:23:32', '15:24:02', '15:24:32', '15:25:02', '15:25:32', '15:26:02', '15:26:32', '15:27:02', '15:27:32', '15:28:02', '15:28:32', '15:29:02', '15:29:32', '15:30:02', '15:30:32', '15:31:02', '15:31:32', '15:32:02', '15:32:32', '15:33:02', '15:33:32', '15:34:02', '15:34:32', '15:35:02', '15:35:32', '15:36:02', '15:36:32', '15:37:02', '15:37:32', '15:38:02', '15:38:32', '15:39:02', '15:39:32', '15:40:02', '15:40:32', '15:41:02', '15:41:32', '15:42:02', '15:42:32', '15:43:02', '15:43:32', '15:44:02', '15:44:32', '15:45:02', '15:45:32', '15:46:02', '15:46:32', '15:47:02', '15:47:32', '15:48:02', '15:48:32', '15:49:02', '15:49:32', '15:50:02', '15:50:32', '15:51:02', '15:51:32', '15:52:02', '15:52:32', '15:53:02', '15:53:32', '15:54:02', '15:54:32', '15:55:02', '15:55:32', '15:56:02', '15:56:32', '15:57:02', '15:57:32', '15:58:02', '15:58:32', '15:59:02', '15:59:32', '16:00:02', '16:00:32', '16:01:03', '16:01:33', '16:02:03', '16:02:33', '16:03:03', '16:03:33', '16:04:03', '16:04:33', '16:05:03', '16:05:33', '16:06:03', '16:06:33', '16:07:03', '16:07:33', '16:08:03', '16:08:33', '16:09:03', '16:09:33', '16:10:03', '16:10:33', '16:11:03', '16:11:33', '16:12:03', '16:12:33', '16:13:03', '16:13:33', '16:14:03', '16:14:33', '16:15:03', '16:15:33']
                }
            ],
            yAxis : [
                {
                    name : 'IO',
                    type : 'value',
                    max : 6
                },
                {
                    name : 'CPU%',
                    type : 'value',
                    max  : 100,
                    splitLine : {show:false}
                }
            ],
            series : [
                {
                    name:'IO',
                    type:'line',
                    //itemStyle: {normal: {lineStyle: {type: 'default'}}},
                   data : ['0', '5.6', '2.9', '1.1', '3.1', '2.7', '2.2', '1.3', '1.8', '1.9', '1.7', '1.3', '1.8', '2.3', '3.1', '2.3', '1.5', '1.9', '1.7', '1.3', '1.8', '2', '2', '1.5', '2.9', '2.9', '1.8', '1.3', '1.5', '2', '1.8', '1.6', '2.1', '2.3', '2.8', '2.3', '1.2', '2', '1.8', '1.3', '1.5', '2.2', '1.7', '1.2', '2.9', '2.6', '1.4', '1.3', '1.5', '1.9', '1.7', '1.4', '1.8', '2.1', '2.8', '2.3', '1.2', '1.9', '1.7', '1.4', '1.8', '1.9', '1.4', '1.2', '2.8', '2.6', '1.4', '1.4', '1.8', '2.2', '1.7', '1.4', '1.8', '2.1', '2.7', '2.4', '1.5', '2.2', '1.7', '1.3', '1.8', '1.9', '1.4', '1.4', '2.8', '2.6', '1.4', '1.4', '1.8', '1.9', '1.8', '1.3', '1.5', '2.1', '2.7', '2.3', '1.5', '2.2', '1.7', '1.1', '1.5', '1.9', '1.7', '1.4', '2.5', '2.9', '1.7', '1.1', '1.5', '1.9', '1.8', '1.3', '1.5', '2.3', '3', '2.4', '1.5', '1.9', '1.8', '1.9', '2.7', '1.9', '1.8', '1.4', '2.6', '2.9', '1.8', '1.1', '1.9', '1.9', '1.5', '1.3', '1.5', '2.3', '3.1', '2.1', '1.5', '1.9', '1.5', '1.4', '1.8', '1.9', '1.5', '1.5', '2.9', '2.6', '1.5', '1.1', '1.8', '1.9', '2.1', '1.5', '2.4', '5.8', '4.4', '2.2', '1.5', '1.9', '1.5', '1.7', '1.7', '1.9', '1.8', '1.5', '3.5', '1.8', '1.5', '1.7', '1.5', '1.8', '1.7', '1.7', '1.7', '1.9', '2.5', '2.3', '1.2', '2.1', '1.7', '1.7'],
                    markPoint : {
                        effect : {
                            show: true,
                            shadowBlur : 0,
                            period:15,
                            color:'red'
                        },
                        itemStyle: {
                            normal: {
                                color: 'red',
                                lineStyle: {        // 系列级个性化折线样式
                                    width: 2,
                                    type: 'dashed'
                                }
                            },
                            emphasis: {
                                color: 'blue'
                            }
                        },

                        data : [
                            // 纵轴，默认
                            {
                                xAxis:'16:02:33',
                                yAxis:5.8,
                                name: '1',
                                value:'1',
                                symbol: 'emptyCircle',
                                symbolSize: 0
                            },{
                                xAxis:'15:49:32',
                                yAxis:1.1,
                                name:'2',
                                value:'2',
                                symbol:'emptyCircle',
                                symbolSize:0
                            }
                            // 横轴
                        ]
                    }
                },
                {
                    name:'CPU%',
                    type:'line',
                    yAxisIndex:1,
                    //itemStyle: {normal: {areaStyle: {type: 'default'}}},
                    data : ['2.9', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.8', '0.2', '19.7', '25.2', '25.1', '25.1', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.1', '25.1', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.1', '25.1', '25.2', '25.2', '25.1', '25.1', '25.1', '25.1', '25.2', '25.2', '25.1', '25.1', '25.2', '25.2', '25.2', '25.1', '25.2', '25.1', '25.1', '25.1', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.1', '25.1', '25.2', '25.1', '25.1', '25.1', '25.2', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.1', '25.1', '25.1', '25.1', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.2', '25.1', '25.2', '25.1', '25.2', '25.2', '25.2', '25.1', '25.2', '25.2', '25.2', '11.4', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1', '0.1']
                }
            ]
        };

        option[1] = {

            tooltip : {
                trigger: 'axis'
            },
            legend: {
                data:['em1-read','em1-write'],
                orient: 'vertical',
                x:'right'
            },

            //calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    axisLine: {onZero: false},
                    data : ['14:46:01', '14:46:31', '14:47:01', '14:47:31', '14:48:01', '14:48:31', '14:49:01', '14:49:31', '14:50:01', '14:50:31', '14:51:01', '14:51:31', '14:52:01', '14:52:31', '14:53:01', '14:53:31', '14:54:01', '14:54:31', '14:55:01', '14:55:31', '14:56:01', '14:56:31', '14:57:01', '14:57:31', '14:58:01', '14:58:31', '14:59:01', '14:59:31', '15:00:01', '15:00:31', '15:01:01', '15:01:31', '15:02:01', '15:02:31', '15:03:01', '15:03:31', '15:04:01', '15:04:31', '15:05:01', '15:05:31', '15:06:01', '15:06:31', '15:07:01', '15:07:31', '15:08:01', '15:08:31', '15:09:01', '15:09:31', '15:10:01', '15:10:31', '15:11:01', '15:11:31', '15:12:01', '15:12:31', '15:13:01', '15:13:31', '15:14:01', '15:14:31', '15:15:01', '15:15:31', '15:16:01', '15:16:31', '15:17:01', '15:17:31', '15:18:02', '15:18:32', '15:19:02', '15:19:32', '15:20:02', '15:20:32', '15:21:02', '15:21:32', '15:22:02', '15:22:32', '15:23:02', '15:23:32', '15:24:02', '15:24:32', '15:25:02', '15:25:32', '15:26:02', '15:26:32', '15:27:02', '15:27:32', '15:28:02', '15:28:32', '15:29:02', '15:29:32', '15:30:02', '15:30:32', '15:31:02', '15:31:32', '15:32:02', '15:32:32', '15:33:02', '15:33:32', '15:34:02', '15:34:32', '15:35:02', '15:35:32', '15:36:02', '15:36:32', '15:37:02', '15:37:32', '15:38:02', '15:38:32', '15:39:02', '15:39:32', '15:40:02', '15:40:32', '15:41:02', '15:41:32', '15:42:02', '15:42:32', '15:43:02', '15:43:32', '15:44:02', '15:44:32', '15:45:02', '15:45:32', '15:46:02', '15:46:32', '15:47:02', '15:47:32', '15:48:02', '15:48:32', '15:49:02', '15:49:32', '15:50:02', '15:50:32', '15:51:02', '15:51:32', '15:52:02', '15:52:32', '15:53:02', '15:53:32', '15:54:02', '15:54:32', '15:55:02', '15:55:32', '15:56:02', '15:56:32', '15:57:02', '15:57:32', '15:58:02', '15:58:32', '15:59:02', '15:59:32', '16:00:02', '16:00:32', '16:01:03', '16:01:33', '16:02:03', '16:02:33', '16:03:03', '16:03:33', '16:04:03', '16:04:33', '16:05:03', '16:05:33', '16:06:03', '16:06:33', '16:07:03', '16:07:33', '16:08:03', '16:08:33', '16:09:03', '16:09:33', '16:10:03', '16:10:33', '16:11:03', '16:11:33', '16:12:03', '16:12:33', '16:13:03', '16:13:33', '16:14:03', '16:14:33', '16:15:03', '16:15:33']
                }
            ],
            dataZoom : {
                show : true,
                realtime : true,
                start : 0,
                end : 100
            },
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [

                {
                    name:'em1-read',
                    type:'line',
                    stack: '总量',
                    itemStyle: {normal: {areaStyle: {type: 'default'}}},
                    data:['7.3', '3.7', '0.8', '0.8', '0.7', '0.7', '0.8', '0.8', '0.9', '0.9', '0.8', '0.9', '1.1', '119.7', '188.7', '169.4', '211.7', '191.7', '194.9', '169.5', '214.1', '190.1', '194.2', '185.7', '194.1', '198.1', '190.4', '195.4', '188', '191.7', '196.8', '190.3', '193.2', '198.6', '190.3', '197.3', '176.8', '203', '195', '190.3', '172.4', '211', '194.9', '194', '167.4', '215.9', '190.3', '196.3', '181.4', '198.2', '196.1', '190.2', '197.3', '185.8', '193.8', '194.3', '190.9', '192.8', '190.5', '195.2', '193.5', '186.2', '197.3', '190.4', '196.2', '176.8', '203.3', '196', '191', '173.4', '213.2', '195.3', '195.5', '170.7', '215.6', '191.2', '196.3', '185', '197.3', '198.4', '191.5', '197.4', '188.2', '194.2', '196.7', '191.9', '193.9', '192', '195.2', '195.9', '186.7', '199.9', '191.5', '196.5', '177.7', '204.8', '198.2', '191.7', '176.3', '217.5', '191.7', '198.2', '181.1', '201.5', '196.1', '192.1', '199.2', '186.4', '195.9', '195.1', '191.9', '193.7', '192', '197', '193.9', '188.5', '197.7', '191.8', '198.3', '177.7', '204.6', '196.1', '192', '172.9', '212.7', '195.7', '195.1', '170.2', '217.4', '192.4', '197', '183.1', '199.2', '197.4', '191.6', '198.3', '187.3', '195.1', '196', '192.1', '193.5', '192.1', '196', '195.2', '186.9', '198.9', '191.5', '197', '177.7', '204.7', '197.4', '191.7', '172.3', '116.1', '0.9', '0.9', '0.9', '0.8', '0.9', '0.8', '0.8', '0.9', '0.9', '1.1', '0.8', '0.9', '0.9', '0.9', '0.8', '0.9', '0.7', '0.8', '0.8', '0.9', '0.8', '1.1', '1', '0.8', '0.8', '0.9']
                },

                {
                    name:'em1-write',
                    type:'line',
                    stack: '总量',
                    itemStyle: {normal: {areaStyle: {type: 'default'}}},
                    data:['0.3', '0.6', '0.5', '0.5', '0.4', '0.4', '0.5', '0.5', '0.5', '0.5', '0.5', '3.5', '1.1', '191.2', '281.4', '297.7', '237', '285.2', '289.4', '304.9', '232.5', '282.8', '288.3', '299.8', '232.8', '293.4', '283.1', '289.9', '247.7', '284.9', '291.8', '283.2', '254.4', '294.1', '283.2', '292.3', '257.6', '275', '289.3', '283.2', '293.3', '243.9', '289.2', '287.7', '305.1', '232.2', '283.2', '290.9', '299.8', '232.8', '290.7', '283.2', '292.6', '244.7', '288.2', '288.5', '284', '254.4', '282.7', '289.3', '287.5', '246.3', '291.2', '283.3', '290.8', '261.1', '271.9', '290.6', '284.1', '298', '241.9', '289.4', '289.9', '306.7', '233.8', '284.4', '290.9', '301.1', '234.7', '293.2', '284.7', '292.2', '248', '287.6', '291.5', '285', '255.6', '284.3', '289.1', '289.9', '246.9', '293.7', '284.6', '290.8', '266.1', '269.5', '293.2', '284.8', '317.1', '233.5', '284.8', '293.4', '301', '234.6', '290.3', '285.3', '294.5', '245.5', '289.9', '289.3', '285', '255.6', '284.3', '291.7', '287.6', '248.9', '291.2', '284.8', '293.4', '260.6', '274.7', '290.5', '285.3', '295.4', '244.4', '290.1', '289.3', '306.3', '233.8', '284.8', '291.7', '301', '234.8', '291.9', '284.8', '293.3', '246.9', '288.5', '290.5', '285.3', '255.3', '284.3', '290.3', '289.3', '247.2', '292.9', '284.6', '292', '263.9', '271.7', '292.2', '284.7', '299.2', '113', '0.5', '0.5', '0.5', '0.4', '0.5', '0.5', '0.4', '0.5', '0.4', '0.6', '0.4', '0.4', '0.5', '0.5', '0.4', '0.4', '0.4', '0.5', '0.5', '0.5', '0.4', '0.5', '0.5', '0.5', '0.4', '0.5']
                }
            ]
        };


        var myCharts=[];
        var newChart = ec.init(document.getElementById('cpu_io_anaylse'));
        myCharts.push(newChart);
         //---检查storeOption ---
       /* var storeOption = window.localStorage? localStorage.getItem("updatedOption"): Cookie.read("updatedOption");
        var storeLegend = window.localStorage? localStorage.getItem("updatedLegend"): Cookie.read("updatedLegend");
        storeOption = JSON.parse(storeOption);
        storeLegend = JSON.parse(storeLegend);
        console.log(storeLegend);
        myCharts[0].setOption(storeOption?storeOption:option[0]);
        if(storeLegend!=null){
            $.each(storeLegend,function(key,val){
            newChart.component.legend.setSelected(key,val);
            console.log("key:"+key+"value:"+val);
            });
        };*/
        myCharts[0].setOption(option[0]);
        $("#charts select").change(
            function(){
                if( $(this).val()=="1"){
                    myCharts[0].clear();
                    myCharts[0].setOption(option[0]);
                }else if(jQuery(this).val()=="2"){
                    myCharts[0].clear();
                    myCharts[0].setOption(option[1]);
                }
            }
        );
        $("#charts .achart:last button[name='delChart']").click(function(){

                    myCharts.splice($(this).parent().index(),1);

                    $(this).parent().remove();
            });

        var addChart=function(){

            //  $("#charts div:first-child").append("<div id='cpu_io_anaylse1' class='pull-center' style='height:400px'></div>");

            id=$("#charts div:first").attr('id')+myCharts.length;
            var selector=$("#selector").clone();

            $("#charts").append("<div class='achart'></div>");
            $("#charts .achart:last").append(selector);
            //$("#charts .achart:last").append("<button class='btn btn-danger btn-sm' name='delChart'>删除</button>");
            $("#charts .achart:last").append($("#charts .achart:first button[name='delChart']").clone());
            $("#charts .achart:last").append($("#charts .achart:first button[name='addChart']").clone());
            $("#charts .achart:last").append($("#charts .achart:first button[name='argSelect']").clone());

            $("#charts .achart:last").append("<div  class='pull-center' style='height:400px'></div>");
            selector.change(
                function(){
                    //alert($(this).index()/2);
                    if( $(this).val()=="1"){

                        myCharts[$(this).parent().index()].setOption(option[0]);
                    }else if(jQuery(this).val()=="2"){

                        myCharts[$(this).parent().index()].clear();
                    }
                }
            );
            $("#charts .achart:last button[name='delChart']").click(function(){

                    myCharts.splice($(this).parent().index(),1);

                    $(this).parent().remove();
            });
            $("#charts .achart:last button[name='addChart']").click(addChart);
            $("#charts select").change(function(){
                    if( $(this).val()=="1"){
                        myCharts[$(this).parent().index()].clear();
                        myCharts[$(this).parent().index()].setOption(option[0]);
                    }else if(jQuery(this).val()=="2"){
                        myCharts[$(this).parent().index()].clear();
                        myCharts[$(this).parent().index()].setOption(option[1]);
                    }
            });
            myCharts.push(ec.init($("#charts div:last")[0]));
            myCharts[myCharts.length-1].setOption(option[0]);
            for(var i=0;i<myCharts.length;i++){
                for(var j=0;j<myCharts.length;j++){
                    myCharts[i].connect(myCharts[j]);
                }
            }

        }

        $("#charts .achart:last button[name='addChart']").click(addChart);

        $("#addChart").click(addChart);

        $("#btn-markmin").toggle(
            function(){
                newChart.setOption({series:[{markPoint:{data:[{},{symbolSize:15}]}}]});
            },
            function(){
                newChart.setOption({series:[{markPoint:{data:[{},{symbolSize:0}]}}]});
            }
        );
        $("#btn-markmax").toggle(
            function(){
                newChart.setOption({series:[{markPoint:{data:[{symbolSize:15},{}]}}]});
            },
            function(){
                newChart.setOption({series:[{markPoint:{data:[{symbolSize:0},{}]}}]});
            }
        );

        $('#switch-cpu').on('switch-change', function (e,data) {
            var value = data.value;
            newChart.component.legend.setSelected('CPU%',value);
            console.log(newChart.component.legend.getSelectedMap());
        });
        $('#switch-io').on('switch-change', function (e,data) {
            var value = data.value;
            newChart.component.legend.setSelected('IO',value);
           // console.log(newChart.getOption());
        });

        $("#getImg").click(function(){
           $(newChart.getImage("png")).appendTo($("body"));

        });

        $("#hello1").click(function(){
           postSimpleData();
        });
        $(".err .modal-footer button[name=confirm]").click(function(){
          //var objStr = JSON.stringify(newChart.getOption());
          //var legStr = JSON.stringify(newChart.component.legend.getSelectedMap());
          //localStorage.setItem("updatedOption", objStr);
          //localStorage.setItem("updatedLegend",legStr);
          //$("#io-err-form").submit();
            postSimpleData();
        });
        function postSimpleData() {
               //console.log('sdf');

            optionToSend=[];
            for(var i=0;i<myCharts.length;i++){
                optionToSend.push(myCharts[i].getOption());
            }


            $.ajax({
                type: "POST",
                url: "/suberr",
                //contentType: "application/json", //必须有
                dataType: "json", //表示返回值类型，不必须
                data: {"options": JSON.stringify(optionToSend)},  //相当于 //data: "{'str1':'foovalue', 'str2':'barvalue'}",
                success: function (jsonResult) {
                    //alert(jsonResult);
                }
            });
        }


    }
);

});
